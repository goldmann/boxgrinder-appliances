#Initial appliance kwalify schema for boxgrinder build
#TODO: add more obscure fields, patterns where needed
type: map
mapping:
  "name":
    type: str
    required: yes
    length: { min: 1 }
  "summary":
    type: str
    required: yes
    length: { min: 1 }
  "version":
    type: int
    range: { min: 0 }
  "release":
    type: int
    range: { min: 0 }
  "os":
    type: map
    mapping:
      "name":
         type: str
         required: yes
         length: { min: 1 }
      "version":
         type: int #required?
         range: { min: 0 }
  "hardware":
    type: map
    mapping:
      "cpus":
        type: int
        range: { min: 1, max: 4 } #do we want to put a max, given future hw trends?
      "memory":
        type: int
        range: { min: 1 }
      "partitions":
        type: map
        mapping:
          "=": #No way of providing validation regex for wildcard name unfortunately.
            type: map
            mapping:             
              "size":
                type: int
                range: { min: 1 }
  "appliances":
    type: seq
    sequence:
      - type: str
        pattern: /^[^\/]+$/ #we dont support path resolution yet
        length: { min: 1 }
        required: yes
  "packages":
    type: seq
    sequence:
      - type: str
        pattern: /^[\w\-+.]+$/ #fedora packaging standard http://bit.ly/h0JN9u (plus a few more, but disallow symbols/spaces)
        length: { min: 1 }
        required: yes
  "repos":
    type: seq
    sequence:
      - type: map
        mapping:
          "name":
            type: str
            pattern: /^[\w\-+.]+$/ #allowing spaces tends to break things
            length: { min: 1 }
            required: yes
          "baseurl":
            type: str #ideally we want xor, can be expressed via eval I think (e.g. baseurl xor mirrorlist)
            pattern: /^((http|ftp|file):)(\/\/([^\/?\043]*))?([^?\043]*)(\?([^\043]*))?(\043(.*))?$/ #customised rfc3986 standard regexp for URIs
            length: { min: 1 }
            # required: yes
          "mirrorlist":
            type: str
            pattern: /^((http|ftp|file):)(\/\/([^\/?\043]*))?([^?\043]*)(\?([^\043]*))?(\043(.*))?$/ #customised rfc3986 standard regexp for URIs
            length: { min: 1 }
            # required: no
          "ephemeral":
            type: bool
  "post":
    type: map
    mapping:
      "=":
        type: seq
        sequence:
          - type: str
            length: { min: 1 }
            required: yes